name: Accept Invitations

on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch:

concurrency:
  group: accept
  
jobs:
  accept:
    runs-on: ubuntu-latest
    steps:
      - uses: plengauer/opentelemetry-github/actions/instrument/job@v5.38.2
        env:
          OTEL_EXPORTER_OTLP_ENDPOINT: ${{ secrets.OTEL_EXPORTER_OTLP_ENDPOINT }}
          OTEL_EXPORTER_OTLP_HEADERS: ${{ secrets.OTEL_EXPORTER_OTLP_HEADERS }}
        with:
          secrets_to_redact: '["${{ github.token }}","${{ secrets.BOT_GITHUB_TOKEN }}"]'
      - run: |
          github() { curl --no-progress-meter -H 'Authorization: Bearer ${{ secrets.BOT_GITHUB_TOKEN }}' https://api.github.com"$@"; }
          github /user/repository_invitations | jq '.[].id' | while read -r invite_id; do github /user/repository_invitations/"$invite_id" -X PATCH; done
    permissions:
      actions: read
